const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BatchImage-DCK45sD3.js","assets/index-CwdUw3Q8.js","assets/index-Cg0ex1tV.css"])))=>i.map(i=>d[i]);
import{c as H,u as w,a as d,b as M,d as v,r as l,j as e,L as $,m as g,U as Y,T as ee,C as L,e as B,f as te,g as ae,h as se,A as re,_ as ie,l as ne,t as de}from"./index-CwdUw3Q8.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],ce=H("credit-card",oe);/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M14 8H8",key:"1l3xfs"}],["path",{d:"M16 12H8",key:"1fr5h0"}],["path",{d:"M13 16H8",key:"wsln4y"}]],xe=H("receipt-text",le),me=l.lazy(()=>ie(()=>import("./BatchImage-DCK45sD3.js"),__vite__mapDeps([0,1,2])));function ge(){const _=w(d.sports.getUserEnrollments),U=M(d.razorpay.createRazorpayOrder),T=M(d.razorpay.verifyRazorpayPayment),F=v(d.sports.updatePaymentStatus),O=v(d.payments.createPayment),V=v(d.payments.setPaymentCompleted),[P,x]=l.useState(null),[z,f]=l.useState(null),[pe,he]=l.useState(null),[q,ue]=l.useState(null),[I,G]=l.useState({}),j=w(d.payments.listPayments,{userId:void 0}),K=({userId:t,batchId:n})=>{const r=w(d.attendance.getStudentAttendance,{studentId:t,batchId:n});return r?r.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No attendance records found for this batch."}):e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsx("h4",{className:"font-semibold",children:"Attendance History:"}),r.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-800 rounded-md",children:[e.jsx("span",{children:new Date(s.date).toLocaleDateString()}),s.isPresent?e.jsxs("span",{className:"text-green-500 flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-1"})," Present"]}):e.jsxs("span",{className:"text-red-500 flex items-center",children:[e.jsx(B,{className:"w-4 h-4 mr-1"})," Absent"]}),e.jsxs("span",{className:"text-gray-400",children:["Method: ",s.method]}),s.notes&&e.jsxs("span",{className:"text-gray-400",children:["Notes: ",s.notes]})]},s._id))]}):e.jsx($,{})},Q=async t=>{var n,r,s,m,p,h;x(t._id),f(null);try{const i=await U({amount:(((n=t.sport)==null?void 0:n.pricePerMonth)||0)*100,currency:"INR",receipt:`receipt_${t._id}`});if(await ne(),!window.Razorpay){f("Razorpay SDK not loaded"),x(null);return}const b={key:"rzp_live_GFajPnphDkUEbt",amount:parseInt(i.amount.toString(),10),currency:i.currency,name:"Sports Academy",description:`Payment for ${((r=t.sport)==null?void 0:r.name)||""} - ${((s=t.batch)==null?void 0:s.name)||""}`,order_id:i.id,handler:async function(o){var u;try{if(!(await T({razorpay_payment_id:o.razorpay_payment_id,razorpay_order_id:o.razorpay_order_id,razorpay_signature:o.razorpay_signature})).verified)throw new Error("Payment verification failed");const y=await O({userId:t.userId,enrollmentId:t._id,amount:((u=t.sport)==null?void 0:u.pricePerMonth)||0,method:"razorpay"});if(!y)throw new Error("Failed to create payment record");await V({paymentId:y,transactionId:o.razorpay_payment_id,paymentDate:Date.now(),receiptNumber:`REC-${Date.now()}`}),await F({enrollmentId:t._id,status:"paid"}),de.success("Payment successful!"),x(null)}catch(c){console.error("Payment verification error:",c),f(c instanceof Error?c.message:"Payment verification failed. Please contact support."),x(null)}},prefill:{name:((m=t.user)==null?void 0:m.name)||"",email:((p=t.user)==null?void 0:p.email)||"",contact:((h=t.user)==null?void 0:h.phone)||""},theme:{color:"#2563EB"}};new window.Razorpay(b).open()}catch(i){console.error("Payment error:",i),f(i instanceof Error?i.message:"Failed to load Razorpay. Please try again."),x(null)}},X=t=>new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}),Z=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(t),J=t=>{switch(t){case"completed":return"bg-green-700 text-green-300";case"pending":return"bg-yellow-700 text-yellow-300";case"failed":return"bg-red-700 text-red-300";case"attempted":return"bg-blue-700 text-blue-300";default:return"bg-gray-700 text-gray-300"}};return _?e.jsx("div",{className:"space-y-10",children:_.map(t=>{var m,p,h,i,b,N,o,u,c,y,S,C,k,A,R,E,D;const n=(j==null?void 0:j.filter(a=>a.enrollmentId===t._id))||[],r=n.sort((a,W)=>W.createdAt-a.createdAt)[0],s=t.attendancePercent||0;return`${((p=(m=t.sport)==null?void 0:m.name)==null?void 0:p.toLowerCase())||"default"}`,e.jsxs(g.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.5,type:"spring"},className:"relative bg-gradient-to-br from-indigo-800/80 via-purple-800/70 to-pink-700/70 rounded-3xl p-8 shadow-2xl border border-indigo-500 flex flex-col md:flex-row gap-8 items-center overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0 w-32 h-32 rounded-2xl overflow-hidden shadow-lg border-4 border-white/20 bg-gray-900",children:e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"w-24 h-24 rounded-xl bg-gray-700 animate-pulse"}),children:e.jsx(me,{src:((h=t.sport)==null?void 0:h.imageUrl)||`/images/sports/${((b=(i=t.sport)==null?void 0:i.name)==null?void 0:b.toLowerCase())||"default"}.jpg`,alt:((N=t.sport)==null?void 0:N.name)||"Sport Image",className:"w-24 h-24 rounded-xl shadow-lg"})})}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-extrabold text-white mb-1 flex items-center gap-2",children:[e.jsx(Y,{className:"text-indigo-300",size:24})," ",(o=t.batch)==null?void 0:o.name]}),e.jsxs("div",{className:"text-indigo-200 text-lg font-medium flex items-center gap-2 mb-1",children:[e.jsx(ee,{className:"text-yellow-400",size:18})," ",(u=t.sport)==null?void 0:u.name]}),e.jsxs("div",{className:"text-indigo-300 text-sm mb-2",children:["Coach: ",((c=t.coach)==null?void 0:c.name)||"-"]}),e.jsxs("div",{className:"text-indigo-400 text-xs",children:["Schedule: ",(C=(S=(y=t.batch)==null?void 0:y.schedule)==null?void 0:S.days)==null?void 0:C.join(", ")," ",(A=(k=t.batch)==null?void 0:k.schedule)==null?void 0:A.startTime," - ",(E=(R=t.batch)==null?void 0:R.schedule)==null?void 0:E.endTime]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[(r==null?void 0:r.status)==="completed"?e.jsxs("span",{className:"px-4 py-2 rounded-xl bg-green-700/80 text-green-200 font-bold flex items-center gap-2 shadow-md",children:[e.jsx(L,{size:18})," Paid"]}):e.jsxs(g.button,{whileHover:{scale:1.05,boxShadow:"0 0 16px #34d399"},className:"px-6 py-2 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-xl font-bold shadow-lg text-lg hover:from-green-600 hover:to-blue-600 transition flex items-center gap-2",onClick:()=>Q(t),disabled:P===t._id,children:[e.jsx(ce,{size:20}),P===t._id?"Processing...":`Pay Now â‚¹${((D=t.sport)==null?void 0:D.pricePerMonth)||0}`]}),z&&e.jsxs("span",{className:"text-red-400 text-sm flex items-center gap-1",children:[e.jsx(B,{size:16})," ",z]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(te,{className:"text-green-400",size:18}),e.jsx("span",{className:"text-green-200 text-sm",children:"Attendance"}),e.jsxs("span",{className:"ml-auto text-green-100 text-xs font-bold",children:[s,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-green-900/40 rounded-full overflow-hidden",children:e.jsx(g.div,{initial:{width:0},animate:{width:`${s}%`},transition:{duration:1},className:"h-full bg-gradient-to-r from-green-400 to-green-600 rounded-full shadow"})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{className:"flex items-center gap-2 text-indigo-200 hover:text-white font-semibold text-sm focus:outline-none",onClick:()=>G(a=>({...a,[t._id]:!a[t._id]})),children:[e.jsx(xe,{size:18})," Payment History",I[t._id]?e.jsx(ae,{size:16}):e.jsx(se,{size:16})]}),e.jsx(re,{initial:!1,children:I[t._id]&&e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},className:"mt-3 overflow-x-auto",children:n.length>0?e.jsxs("table",{className:"min-w-full border text-sm bg-white/10 rounded-xl overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-indigo-900/80 text-indigo-100",children:[e.jsx("th",{className:"border px-2 py-1",children:"Date"}),e.jsx("th",{className:"border px-2 py-1",children:"Amount"}),e.jsx("th",{className:"border px-2 py-1",children:"Status"}),e.jsx("th",{className:"border px-2 py-1",children:"Method"}),e.jsx("th",{className:"border px-2 py-1",children:"Receipt"})]})}),e.jsx("tbody",{children:n.map(a=>e.jsxs("tr",{className:"hover:bg-indigo-900/40 transition",children:[e.jsx("td",{className:"border px-2 py-1 text-indigo-100",children:X(a.createdAt)}),e.jsx("td",{className:"border px-2 py-1 text-pink-200 font-bold",children:Z(a.amount)}),e.jsx("td",{className:`border px-2 py-1 font-bold ${J(a.status)}`,children:a.status.charAt(0).toUpperCase()+a.status.slice(1)}),e.jsx("td",{className:"border px-2 py-1 text-indigo-100",children:a.method}),e.jsx("td",{className:"border px-2 py-1 text-indigo-100",children:a.receiptNumber||"-"})]},a._id))})]}):e.jsx("div",{className:"text-indigo-200 py-4",children:"No payment history found."})})})]}),q===t.batchId&&e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.4},className:"mt-8",children:e.jsx(K,{userId:t.userId,batchId:t.batchId})})]}),e.jsx("div",{className:"absolute -top-8 -right-8 w-32 h-32 bg-pink-400/20 rounded-full blur-2xl animate-pulse"}),e.jsx("div",{className:"absolute -bottom-8 -left-8 w-24 h-24 bg-indigo-400/20 rounded-full blur-2xl animate-pulse"})]},t._id)})}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx($,{size:"lg"})})}export{ge as MyBatches,ge as default};
